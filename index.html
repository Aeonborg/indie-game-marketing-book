<!DOCTYPE html>
<html>
<head>
  <title>Indie Game Marketing Book</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: auto; padding: 20px; }
    button { padding: 10px; margin: 5px 0; }
    input { padding: 8px; margin: 5px 0; width: 100%; }
    #chapters { margin-top: 20px; }
  </style>
</head>
<body>

  <h1>ðŸ“˜ Indie Game Marketing: Ultimate Guide</h1>
  <p>Read the first 3 chapters free. Register to unlock the full book.</p>

  <h2>Register / Login</h2>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
  <button onclick="logout()">Logout</button>

  <hr>

  <button onclick="loadFree()">ðŸ“– Read Free Chapters</button>
  <button onclick="loadAll()">ðŸ”’ Read Full Book</button>

  <div id="chapters"></div>

  <!-- Supabase Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const supabase = window.supabase.createClient(
      "YOUR_PROJECT_URL",
      "YOUR_ANON_KEY"
    );

    async function register() {
      const email = emailInput.value;
      const password = passwordInput.value;
      const { error } = await supabase.auth.signUp({ email, password });
      alert(error ? error.message : "Registered! Now login.");
    }

    async function login() {
      const email = emailInput.value;
      const password = passwordInput.value;
      const { error } = await supabase.auth.signInWithPassword({ email, password });
      alert(error ? error.message : "Logged in!");
    }

    async function logout() {
      await supabase.auth.signOut();
      alert("Logged out");
    }

    async function loadFree() {
      const { data } = await supabase
        .from("chapters")
        .select("*")
        .eq("is_free", true);

      showChapters("Free Chapters", data);
    }

    async function loadAll() {
      const { data, error } = await supabase
        .from("chapters")
        .select("*");

      if (error) {
        alert("Login required to read full book.");
        return;
      }

      showChapters("Full Book", data);
    }

    function showChapters(title, chapters) {
      const container = document.getElementById("chapters");
      container.innerHTML = `<h2>${title}</h2>`;
      chapters.forEach(ch => {
        container.innerHTML += `<h3>${ch.title}</h3><p>${ch.content}</p>`;
      });
    }

    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
  </script>

</body>
</html>
